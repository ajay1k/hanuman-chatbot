{% extends "base.html" %}
{% block title %}Register{% endblock %}
{% block header_links %}
    <a href="{{ url_for('login') }}" class="text-[var(--primary)] hover:underline focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">Log In</a>
{% endblock %}
{% block content %}
<h2 class="text-2xl sm:text-3xl font-playfair text-[var(--primary)] mb-6">Begin Your Spiritual Journey</h2>

<form method="POST" class="space-y-5 max-w-md">
    {{ form.hidden_tag() }}
    <div class="relative tooltip-target">
        <label class="block text-sm font-medium text-[var(--text)]" for="{{ form.username.id }}">{{ form.username.label }}</label>
        {{ form.username(class="mt-1 block w-full px-4 py-2 neumo border border-[var(--primary)]/20 rounded-lg text-[var(--text)] focus:ring-[var(--primary)] focus:border-[var(--primary)] transition duration-200", placeholder="Choose a username", **{'aria-describedby': 'username-error'}) }}
        <span class="tooltip absolute -top-8 left-0 glass text-[var(--text)] text-xs p-2 rounded shadow-lg">Pick a unique username</span>
        {% for error in form.username.errors %}
            <p id="username-error" class="text-red-600 text-sm mt-1" role="alert">{{ error }}</p>
        {% endfor %}
    </div>
    <div class="relative tooltip-target">
        <label class="block text-sm font-medium text-[var(--text)]" for="{{ form.password.id }}">{{ form.password.label }}</label>
        {{ form.password(class="mt-1 block w-full px-4 py-2 neumo border border-[var(--primary)]/20 rounded-lg text-[var(--text)] focus:ring-[var(--primary)] focus:border-[var(--primary)] transition duration-200", placeholder="Enter your password", **{'aria-describedby': 'password-error'}) }}
        <span class="tooltip absolute -top-8 left-0 glass text-[var(--text)] text-xs p-2 rounded shadow-lg">Use at least 8 characters with uppercase, lowercase, number, and special character</span>
        {% for error in form.password.errors %}
            <p id="password-error" class="text-red-600 text-sm mt-1" role="alert">{{ error }}</p>
        {% endfor %}
    </div>
    <div class="relative tooltip-target">
        <label class="block text-sm font-medium text-[var(--text)]" for="{{ form.confirm_password.id }}">{{ form.confirm_password.label }}</label>
        {{ form.confirm_password(class="mt-1 block w-full px-4 py-2 neumo border border-[var(--primary)]/20 rounded-lg text-[var(--text)] focus:ring-[var(--primary)] focus:border-[var(--primary)] transition duration-200", placeholder="Confirm your password", **{'aria-describedby': 'confirm-password-error'}) }}
        <span class="tooltip absolute -top-8 left-0 glass text-[var(--text)] text-xs p-2 rounded shadow-lg">Re-enter your password</span>
        {% for error in form.confirm_password.errors %}
            <p id="confirm-password-error" class="text-red-600 text-sm mt-1" role="alert">{{ error }}</p>
        {% endfor %}
    </div>
    <div>
        {{ form.submit(class="w-full bg-[var(--primary)] text-white py-2 px-4 rounded-lg btn-cta hover:bg-[var(--secondary)] focus:ring-2 focus:ring-[var(--primary)] focus:ring-offset-2 transition duration-200") }}
    </div>
</form>

<p class="mt-4 text-sm text-[var(--text)]">
    Already have an account? <a href="{{ url_for('login') }}" class="text-[var(--primary)] hover:underline focus:outline-none focus:ring-2 focus:ring-[var(--primary)]">Log In</a>
</p>
<script defer>
    if (typeof gsap !== 'undefined') {
        gsap.from("form > div", { y: 20, opacity: 0, duration: 0.8, stagger: 0.2, ease: "power3.out" });
        gsap.from("h2", { x: -50, opacity: 0, duration: 1, ease: "power3.out" });
    } else {
        console.warn('GSAP not loaded, form animations disabled');
        document.querySelectorAll('form > div, h2').forEach(el => {
            el.style.opacity = 1;
            el.style.transform = 'none';
        });
    }
</script>
{% endblock %}