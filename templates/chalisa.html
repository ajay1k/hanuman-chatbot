<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanuman Chalisa Player</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Tiro+Devanagari+Sanskrit:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --primary-color: #FF9933; /* Saffron */
            --secondary-color: #aff5722; /* Deep Orange */
            --background-dark: #0d1117;
            --container-bg: #161b22;
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #e6edf3;
            --text-secondary: #7d8590;
            --font-serif: 'Tiro Devanagari Sanskrit', serif;
            --font-sans: 'Poppins', sans-serif;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--background-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-primary);
        }

        video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -2; opacity: 0.2; filter: blur(4px); }

        .page-container {
            display: flex;
            width: 95%;
            max-width: 1500px;
            height: 95vh;
            background: var(--container-bg);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        /* --- Lyrics Panel (Left) --- */
        .lyrics-panel {
            flex: 1;
            padding: 50px;
            overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }
        .lyrics-panel h1 {
            font-family: var(--font-serif);
            font-size: 2.8em;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 40px;
            font-weight: 400;
        }
        .lyrics-content {
            font-family: var(--font-serif);
            font-size: 1.6em;
            line-height: 2.3;
            color: var(--text-primary);
        }
        .lyrics-content p {
            margin-bottom: 2em;
            transition: color 0.4s, transform 0.4s;
            opacity: 0.7;
        }
        .lyrics-content p.highlight {
            color: var(--primary-color);
            transform: scale(1.03);
            opacity: 1;
            text-shadow: 0 0 10px rgba(255, 153, 51, 0.3);
        }

        /* --- Player Panel (Right) --- */
        .player-panel {
            width: 420px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 50px;
            background-color: var(--background-dark);
        }
        .player-header { text-align: center; }
        .om-logo { font-size: 4.5em; color: var(--primary-color); text-shadow: 0 0 20px var(--primary-color); }
        .player-header h2 { font-weight: 600; font-size: 2em; margin: 15px 0 5px; }
        .player-header p { font-size: 1.1em; color: var(--text-secondary); }
        
        .player-controls { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .progress-bar { width: 100%; height: 8px; background: var(--container-bg); border-radius: 4px; cursor: pointer; }
        .progress { height: 100%; background: var(--primary-color); width: 0; border-radius: 4px; }
        .time-display { width: 100%; display: flex; justify-content: space-between; font-size: 0.9em; color: var(--text-secondary); }
        .controls { display: flex; align-items: center; gap: 25px; }
        
        .control-button {
            width: 50px; height: 50px; border-radius: 50%;
            background: var(--container-bg); color: var(--text-secondary);
            border: 1px solid var(--border-color); font-size: 1.2em;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s;
        }
        .control-button:hover { color: var(--text-primary); border-color: var(--primary-color); }
        
        .play-pause-button {
            width: 80px; height: 80px; font-size: 2.2em;
            background: var(--primary-color); color: white; border: none;
        }
        .play-pause-button:hover { background-color: var(--secondary-color); }
        
        .nav-buttons { display: flex; justify-content: space-between; width: 100%; }
        .nav-buttons a {
            color: var(--text-secondary); text-decoration: none; padding: 10px 15px;
            border-radius: 8px; transition: all 0.2s ease;
        }
        .nav-buttons a:hover { background-color: var(--container-bg); color: var(--text-primary); }
        
        @media (max-width: 1200px) {
            .page-container { flex-direction: column; height: auto; max-height: none; }
            .player-panel { width: 100%; border-top: 1px solid var(--border-color); padding: 30px; }
            .lyrics-panel { padding: 30px; height: 60vh; }
        }
    </style>
</head>
<body>
    <video autoplay muted loop id="background-video" preload="auto">
        <source src="{{ url_for('static', filename='hanuman.mp4') }}" type="video/mp4">
    </video>

    <div class="page-container">
        <!-- Lyrics Panel (Left Side) -->
        <div class="lyrics-panel">
            <h1>‡§π‡§®‡•Å‡§Æ‡§æ‡§® ‡§ö‡§æ‡§≤‡•Ä‡§∏‡§æ</h1>
            <div class="lyrics-content" id="lyrics">
                <p data-start="0">‡§∂‡•ç‡§∞‡•Ä‡§ó‡•Å‡§∞‡•Å ‡§ö‡§∞‡§® ‡§∏‡§∞‡•ã‡§ú ‡§∞‡§ú ‡§®‡§ø‡§ú ‡§Æ‡§®‡•Å ‡§Æ‡•Å‡§ï‡•Å‡§∞‡•Å ‡§∏‡•Å‡§ß‡§æ‡§∞‡§ø‡•§<br>‡§¨‡§∞‡§®‡§â‡§Å ‡§∞‡§ò‡•Å‡§¨‡§∞ ‡§¨‡§ø‡§Æ‡§≤ ‡§ú‡§∏‡•Å ‡§ú‡•ã ‡§¶‡§æ‡§Ø‡§ï‡•Å ‡§´‡§≤ ‡§ö‡§æ‡§∞‡§ø‡•§</p>
                <p data-start="6.2">‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø‡§π‡•Ä‡§® ‡§§‡§®‡•Å ‡§ú‡§æ‡§®‡§ø‡§ï‡•á ‡§∏‡•Å‡§Æ‡§ø‡§∞‡•å ‡§™‡§µ‡§® ‡§ï‡•Å‡§Æ‡§æ‡§∞‡•§<br>‡§¨‡§≤ ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø ‡§¨‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§¶‡•á‡§π‡•Å ‡§Æ‡•ã‡§π‡§ø ‡§π‡§∞‡§π‡•Å ‡§ï‡§≤‡•á‡§∏ ‡§¨‡§ø‡§ï‡§æ‡§∞‡•§</p>
                <p data-start="10.5">‡§ú‡§Ø ‡§π‡§®‡•Å‡§Æ‡§æ‡§® ‡§ú‡•ç‡§û‡§æ‡§® ‡§ó‡•Å‡§® ‡§∏‡§æ‡§ó‡§∞‡•§ ‡§ú‡§Ø ‡§ï‡§™‡•Ä‡§∏ ‡§§‡§ø‡§π‡•Å‡§Å ‡§≤‡•ã‡§ï ‡§â‡§ú‡§æ‡§ó‡§∞‡•§</p>
                <!-- Add all 43 verses as <p> tags with data-start attributes -->
                <p data-start="203.5">‡§™‡§µ‡§® ‡§§‡§®‡§Ø ‡§∏‡§Ç‡§ï‡§ü ‡§π‡§∞‡§® ‡§Æ‡§Ç‡§ó‡§≤ ‡§Æ‡•Ç‡§∞‡§§‡§ø ‡§∞‡•Ç‡§™‡•§<br>‡§∞‡§æ‡§Æ ‡§≤‡§ñ‡§® ‡§∏‡•Ä‡§§‡§æ ‡§∏‡§π‡§ø‡§§ ‡§π‡•É‡§¶‡§Ø ‡§¨‡§∏‡§π‡•Å ‡§∏‡•Å‡§∞ ‡§≠‡•Ç‡§™‡•§</p>
            </div>
        </div>

        <!-- Player Panel (Right Side) -->
        <div class="player-panel">
            <div class="player-header">
                <div class="om-logo">üïâÔ∏è</div>
                <h2>Hanuman Chalisa</h2>
                <p>Divine Hymn of Devotion</p>
            </div>
            
            <div class="player-controls">
                <audio id="hanumanAudio" preload="auto" src="{{ url_for('static', filename='hanuman-chalisa.mp3') }}"></audio>
                <div class="progress-bar" id="progressBar"><div class="progress" id="progress"></div></div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalDuration">0:00</span>
                </div>
                <div class="controls">
                    <button id="restartButton" class="control-button"><i class="fas fa-redo-alt"></i></button>
                    <button id="playPauseButton" class="play-pause-button"><i class="fas fa-play"></i></button>
                    <button id="chat-bubble" class="control-button"><i class="fas fa-comment-dots"></i></button>
                </div>
            </div>

            <div class="nav-buttons">
                <a href="{{ url_for('chat') }}"><i class="fas fa-arrow-left"></i> Back to Chat</a>
                <a href="{{ url_for('logout') }}">Logout <i class="fas fa-sign-out-alt"></i></a>
            </div>
        </div>
    </div>
    
    <!-- Chat Widget remains structurally the same but is now controlled from the player controls -->

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const audio = document.getElementById('hanumanAudio');
        const lyricParagraphs = Array.from(document.querySelectorAll('#lyrics p'));
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const playPauseButton = document.getElementById('playPauseButton');
        const restartButton = document.getElementById('restartButton');
        const currentTimeEl = document.getElementById('currentTime');
        const totalDurationEl = document.getElementById('totalDuration');
        let currentLineEl = null;

        // NOTE: Timings must be manually set to match your audio file
        const lyricTimings = [0, 6.2, 10.5, /* ... all other timings ... */ 203.5];

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        audio.onloadedmetadata = () => {
            totalDurationEl.textContent = formatTime(audio.duration);
        };

        function highlightLyrics() {
            const currentTime = audio.currentTime;
            let activeParagraph = null;
            for (let i = 0; i < lyricParagraphs.length; i++) {
                const startTime = parseFloat(lyricParagraphs[i].dataset.start || lyricTimings[i]);
                if (currentTime >= startTime) {
                    activeParagraph = lyricParagraphs[i];
                } else {
                    break;
                }
            }
            if (activeParagraph && activeParagraph !== currentLineEl) {
                lyricParagraphs.forEach(p => p.classList.remove('highlight'));
                activeParagraph.classList.add('highlight');
                currentLineEl = activeParagraph;
                activeParagraph.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
            }
        }

        function updateProgress() {
            if (audio.duration) {
                progress.style.width = `${(audio.currentTime / audio.duration) * 100}%`;
                currentTimeEl.textContent = formatTime(audio.currentTime);
            }
        }
        function seek(event) {
            const width = progressBar.clientWidth;
            const clickX = event.offsetX;
            audio.currentTime = (clickX / width) * audio.duration;
        }

        function togglePlayPause() {
            if (audio.paused) {
                audio.play();
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        playPauseButton.addEventListener('click', togglePlayPause);
        restartButton.addEventListener('click', () => { audio.currentTime = 0; });
        audio.addEventListener('timeupdate', () => { updateProgress(); highlightLyrics(); });
        progressBar.addEventListener('click', seek);
        audio.addEventListener('ended', () => { playPauseButton.innerHTML = '<i class="fas fa-play"></i>'; });
        
        // Chat widget logic could be added here if needed, controlled by the chat bubble button
    });
    </script>
</body>
</html>

